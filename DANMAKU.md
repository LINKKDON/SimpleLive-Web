# 弹幕功能使用指南

## 📺 功能概述

Simple Live Web 内置了完整的弹幕功能，支持实时显示弹幕、礼物、欢迎消息等，并提供丰富的自定义设置。

## ✨ 功能特性

### 弹幕显示
- ✅ 实时弹幕（延迟 < 200ms）
- ✅ 滚动弹幕动画
- ✅ 多轨道显示（自动避免重叠）
- ✅ VIP/管理员弹幕高亮
- ✅ 弹幕阴影效果（确保可读性）

### 系统消息
- ✅ 礼物消息（紫色渐变气泡）
- ✅ 欢迎消息（蓝色气泡）
- ✅ 系统通知（橙色气泡）
- ✅ 开播/下播提醒

### 数据统计
- ✅ 实时人气值显示
- ✅ 在线人数统计
- ✅ 弹幕密度自适应

## 🎮 使用方法

### 基础操作

#### 1. 开关弹幕
点击视频右上角的 **💬 弹幕** 按钮即可开关弹幕显示。

```
💬 弹幕 → 弹幕开启（白色）
🚫 弹幕 → 弹幕关闭（半透明）
```

#### 2. 打开设置
点击视频右上角的 **⚙️ 设置** 按钮打开弹幕设置面板。

### 弹幕设置

#### 显示弹幕
- **功能**: 总开关，控制是否显示弹幕
- **默认值**: 开启
- **快捷方式**: 点击 💬 按钮

#### 不透明度
- **功能**: 调整弹幕透明度
- **范围**: 0% - 100%
- **默认值**: 80%
- **建议**: 
  - 白天/亮色背景: 80-100%
  - 夜间/暗色背景: 60-80%

#### 字体大小
- **功能**: 调整弹幕文字大小
- **范围**: 16px - 36px
- **默认值**: 24px
- **建议**:
  - 桌面端: 24-28px
  - 移动端: 18-22px（自动适配）

#### 弹幕速度
- **功能**: 控制弹幕移动速度
- **范围**: 4秒 - 12秒
- **默认值**: 8秒
- **说明**: 数值越大，弹幕移动越慢
- **建议**:
  - 快速模式: 4-6秒（适合低密度弹幕）
  - 正常模式: 7-9秒（推荐）
  - 慢速模式: 10-12秒（适合高密度弹幕）

#### 显示区域
- **功能**: 控制弹幕显示的垂直范围
- **范围**: 25% - 100%
- **默认值**: 100%
- **说明**: 
  - 100% = 全屏显示
  - 50% = 仅上半屏显示
  - 25% = 仅顶部 1/4 显示
- **建议**: 如果弹幕遮挡重要内容，可以调整为 50-75%

## 🎨 弹幕样式

### 普通弹幕
- **颜色**: 白色
- **样式**: 粗体 + 黑色阴影

### VIP 弹幕
- **颜色**: 金黄色 (#ffeb3b)
- **样式**: 超粗体 + 黑色阴影

### 管理员弹幕
- **颜色**: 橙红色 (#ff5722)
- **样式**: 超粗体 + 黑色阴影

### 系统消息样式

#### 礼物消息
```
背景: 紫色渐变
位置: 底部居中
动画: 脉冲缩放
持续: 3秒
```

#### 欢迎消息
```
背景: 蓝色半透明
位置: 底部居中
持续: 3秒
```

#### 系统通知
```
背景: 橙色半透明
位置: 底部居中
持续: 3秒
```

## 🔧 技术原理

### WebSocket 连接

弹幕通过 WebSocket 直连 B站弹幕服务器：

```javascript
// 连接地址
wss://broadcastlv.chat.bilibili.com/sub

// 连接流程
1. 建立 WebSocket 连接
2. 发送进房间包
3. 开始接收弹幕
4. 每 30 秒发送心跳
5. 断线自动重连
```

### 数据包结构

B站弹幕使用二进制协议：

```
┌─────────────────────────────────┐
│ Header (16 bytes)               │
├─────────────────────────────────┤
│ - Packet Length (4 bytes)       │
│ - Header Length (2 bytes)       │
│ - Protocol Version (2 bytes)    │
│ - Operation (4 bytes)           │
│ - Sequence (4 bytes)            │
├─────────────────────────────────┤
│ Payload (JSON/Binary)           │
└─────────────────────────────────┘
```

### 弹幕渲染

```javascript
// 渲染流程
1. 接收弹幕数据
2. 创建 DOM 元素
3. 随机分配轨道
4. 设置 CSS 动画
5. 动画结束后移除
```

### 性能优化

1. **DOM 复用**: 限制最大弹幕数量（100条）
2. **CSS 动画**: 使用 GPU 加速的 `transform`
3. **节流处理**: 高密度弹幕自动跳过
4. **内存管理**: 及时清理过期弹幕元素

## 📱 移动端适配

### 自动优化
- 字体大小自动缩小（18px）
- 触摸区域优化
- 横屏模式适配

### 横屏模式
当手机横屏时：
- 弹幕字体: 16px
- 系统消息位置下移
- 控制按钮尺寸缩小

## 🐛 常见问题

### Q: 弹幕不显示？

**可能原因**:
1. 弹幕已关闭
2. 主播未开播
3. WebSocket 连接失败
4. 房间号错误

**解决方法**:
1. 检查弹幕按钮是否开启（💬 白色）
2. 确认直播状态
3. 打开浏览器控制台查看连接状态
4. 刷新页面重试

### Q: 弹幕密度太大，看不清画面？

**解决方法**:
1. 降低不透明度（50-60%）
2. 减小显示区域（50-75%）
3. 临时关闭弹幕

### Q: 弹幕移动太快/太慢？

**解决方法**:
打开弹幕设置，调整"弹幕速度"：
- 太快 → 增加数值（10-12秒）
- 太慢 → 减小数值（4-6秒）

### Q: 移动端弹幕太小/太大？

**解决方法**:
移动端会自动适配，但可以手动调整：
- 打开设置 → 字体大小
- 移动端建议: 18-22px

### Q: 弹幕延迟高？

**可能原因**:
1. 网络问题
2. 弹幕服务器负载高

**解决方法**:
1. 检查网络连接
2. 刷新页面重连
3. 正常延迟 < 200ms，超过 1 秒需检查网络

### Q: 弹幕位置重叠？

**说明**: 
弹幕密度极高时可能出现轻微重叠，这是正常现象。

**解决方法**:
1. 增加弹幕速度（让弹幕更快消失）
2. 减小显示区域（增加轨道密度）

## 🔐 隐私说明

### 数据流向

```
浏览器 ──WebSocket──> B站弹幕服务器
   │
   └── 不经过我们的服务器
```

### 数据收集

- ❌ 不记录用户观看历史
- ❌ 不存储弹幕内容
- ❌ 不收集用户信息
- ✅ 所有数据实时处理，不落盘

### 连接信息

连接弹幕时使用的 UID 固定为 `0`（游客身份），不需要登录。

## 🚀 高级功能（计划中）

### 即将支持
- [ ] 发送弹幕（需要登录）
- [ ] 弹幕过滤（关键词屏蔽）
- [ ] 弹幕录制
- [ ] 弹幕统计
- [ ] 自定义弹幕样式
- [ ] 特效弹幕

### 开发中
- [ ] 超级聊天（SuperChat）
- [ ] 舰长进场特效
- [ ] 弹幕点赞功能
- [ ] 热词云图

## 💡 使用技巧

### 技巧 1: 重要画面时临时关闭弹幕
快速双击 💬 按钮可以快速开关弹幕。

### 技巧 2: 精彩时刻保留上方画面
将"显示区域"设置为 50%，弹幕只在下半屏显示。

### 技巧 3: 夜间模式
降低不透明度到 60%，眼睛更舒适。

### 技巧 4: 高密度弹幕优化
```
不透明度: 50%
字体大小: 20px
弹幕速度: 10秒
显示区域: 75%
```

### 技巧 5: 极简模式
```
不透明度: 100%
字体大小: 18px
弹幕速度: 6秒
显示区域: 25%
```

## 📊 性能指标

### 理想状态
- 弹幕延迟: < 200ms
- CPU 占用: < 5%
- 内存占用: < 50MB
- 流畅度: 60 FPS

### 压力测试
- 支持同时显示: 100 条弹幕
- 高密度场景: 自动节流
- 内存管理: 自动清理

## 🔄 更新日志

### v1.0.0 (2024-01-XX)
- ✅ 实现基础弹幕显示
- ✅ WebSocket 连接管理
- ✅ 弹幕设置面板
- ✅ 移动端适配
- ✅ 礼物和欢迎消息
- ✅ 实时人气值

### 计划中
- [ ] 发送弹幕功能
- [ ] 弹幕过滤
- [ ] 更多特效

---

**有问题？** 请在 GitHub 提交 Issue 或 PR！